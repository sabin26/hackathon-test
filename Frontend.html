<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Padmavyūha Football Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
    import { ConvexClient } from "https://esm.sh/convex/browser";
    </script>
    <!-- Chosen Palette: Slate & Amber -->
    <!-- Application Structure Plan: The application is designed as a live, interactive sandbox rather than a linear document. The structure prioritizes immediate user engagement by placing the core functionality—the video uploader, player, and real-time dashboard—at the top. This "demo-first" approach allows users to instantly experience the concepts from the report. Below the demo, collapsible sections provide deeper, contextual explanations ("How It Works"), such as a live event log and a view of the underlying JavaScript logic. This non-linear structure transforms the report's passive information into an active learning tool, where users can see cause and effect in real time, making the complex technical concepts more tangible and understandable. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Core analytics metrics (play/pause counts, watch time). Goal: Inform/Status. Viz: Dynamic stat cards (HTML/Tailwind). Interaction: Real-time updates from video events. Justification: Clear, immediate feedback of key metrics. Method: Vanilla JS DOM manipulation.
        - Report Info: Video progress. Goal: Change/Status. Viz: Doughnut Chart (Watch Time vs. Remaining). Interaction: Updates on 'timeupdate'. Justification: Provides a more engaging visual representation of progress than a simple number. Method: Chart.js.
        - Report Info: Media Events table. Goal: Inform/Debug. Viz: Live-updating Event Log. Interaction: New events are prepended as the user interacts with the video. Justification: Powerfully demonstrates the source of all analytics data in a way a static table cannot. Method: Vanilla JS DOM manipulation.
        - Report Info: 'useVideoAnalytics' hook code. Goal: Educate/Explain. Viz: Collapsible code block. Interaction: Click to toggle visibility. Justification: Directly connects the visible functionality to the underlying implementation code. Method: HTML/JS toggle.
        - Report Info: Player choice comparison. Goal: Compare. Viz: Simple text sections. Interaction: Static read. Justification: Provides necessary context from the report without over-complicating the UI. Method: Static HTML.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 300px;
        }
        .stat-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .stat-card-title {
            color: #475569; /* slate-600 */
            font-weight: 500;
        }
        .stat-card-value {
            color: #1e293b; /* slate-800 */
            font-size: 2.25rem;
            font-weight: 700;
        }
        .event-log-entry {
            transition: background-color 0.5s ease;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .code-block {
            background-color: #1e293b; /* slate-800 */
            color: #e2e8f0; /* slate-200 */
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
        }
        .accordion-button::after {
            content: '▼';
            float: right;
            transition: transform 0.2s ease;
        }
        .accordion-button.open::after {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="text-slate-700">

    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-bold leading-tight text-slate-900">Padmavyūha Football Analytics</h1>
            <p class="mt-1 text-slate-500">A live demonstration of real time analytics generated through AI</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Uploader Section -->
        <div id="uploaderSection" class="text-center bg-white p-8 rounded-xl shadow-lg border border-slate-200">
            <h2 class="text-2xl font-semibold text-slate-800 mb-4">Start by Selecting a Video</h2>
            <p class="text-slate-500 mb-6 max-w-2xl mx-auto">Choose a video file from your local machine. The video and all analytics will be handled entirely within your browser and will not be uploaded.</p>
            <input type="file" id="videoUpload" class="hidden" accept="video/*">
            <label for="videoUpload" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 cursor-pointer transition-transform hover:scale-105">
                Select Video File
            </label>
            <div id="fileInfo" class="mt-4 text-sm text-slate-500"></div>
        </div>

        <!-- Main Dashboard Section (hidden by default) -->
        <div id="dashboardSection" class="hidden mt-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Video Player -->
                <div class="lg:col-span-2 bg-white p-4 rounded-xl shadow-lg border border-slate-200">
                     <p class="text-lg font-semibold text-slate-800 mb-4 px-2">Video Player</p>
                    <video id="videoPlayer" class="w-full rounded-lg" controls playsinline></video>
                </div>
                <!-- Analytics Overview -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200 flex flex-col justify-center">
                     <p class="text-lg font-semibold text-slate-800 mb-4 text-center">Event Timeline</p>
                    <div class="chart-container">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
             <div class="mt-8">
                <h3 class="text-xl font-semibold text-slate-800 mb-4">Team Analytics</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
                    <div class="stat-card text-center">
                        <p class="stat-card-title">Ball Possession</p>
                        <p id="statState" class="stat-card-value text-3xl mt-1">Idle</p>
                    </div>
                    <div class="stat-card text-center">
                        <p class="stat-card-title">Shots</p>
                        <p id="statPlayCount" class="stat-card-value">0</p>
                    </div>
                    <div class="stat-card text-center">
                        <p class="stat-card-title">Successful Passes</p>
                        <p id="statPauseCount" class="stat-card-value">0</p>
                    </div>
                    <div class="stat-card text-center">
                        <p class="stat-card-title">Tackles</p>
                        <p id="statSeekCount" class="stat-card-value">0</p>
                    </div>
                     <div class="stat-card text-center">
                        <p class="stat-card-title">Goals</p>
                        <p id="statCompleted" class="stat-card-value text-3xl mt-1">No</p>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
             <div class="mt-8">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
                    <div class="stat-card text-center">
                        <p class="stat-card-title">Ball Possession</p>
                        <p id="statState" class="stat-card-value text-3xl mt-1">Idle</p>
                    </div>
                    <div class="stat-card text-center">
                        <p class="stat-card-title">Shots</p>
                        <p id="statPlayCount" class="stat-card-value">0</p>
                    </div>
                    <div class="stat-card text-center">
                        <p class="stat-card-title">Successful Passes</p>
                        <p id="statPauseCount" class="stat-card-value">0</p>
                    </div>
                    <div class="stat-card text-center">
                        <p class="stat-card-title">Tackles</p>
                        <p id="statSeekCount" class="stat-card-value">0</p>
                    </div>
                     <div class="stat-card text-center">
                        <p class="stat-card-title">Goals</p>
                        <p id="statCompleted" class="stat-card-value text-3xl mt-1">No</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- How It Works Section -->
        <div id="howItWorksSection" class="hidden mt-12">
            <h2 class="text-3xl font-bold text-slate-900 mb-6 text-center">Player Performance Metrics</h2>
            <div class="space-y-4">
                <!-- Event Log -->
                <div class="bg-white rounded-xl shadow-lg border border-slate-200">
                    <button class="accordion-button w-full text-left p-6 font-semibold text-slate-800 text-lg open">Live Media Event Log</button>
                    <div class="accordion-content px-6 pb-6">
                        <p class="text-slate-600 mb-4">Recommended Approaches.</p>
                            <p class="text-slate-400 text-center">The "Player Card" Grid</p>
                            <p class="text-slate-400 text-center">The Interactive "Heatmap" Table</p>
                            <p class="text-slate-400 text-center">The "Master-Detail" View</p>
                        </div>
                    </div>
                </div>

                <!-- The Analytics Hook Code -->
                <div class="bg-white rounded-xl shadow-lg border border-slate-200">
                    <button class="accordion-button w-full text-left p-6 font-semibold text-slate-800 text-lg">The Analytics Engine (JavaScript Code)</button>
                    <div class="accordion-content px-6 pb-6 hidden">
                        <div class="code-block">

                        </div>
                    </div>

        <div id="user-table">Loading...</div>
                </div>
            </div>
        </div>

    </main>


    <script type="module">
          import { ConvexClient } from "https://esm.sh/convex/browser";
          import { api } from "./convex/_generated/api"; // Make sure this path exists

          // Connect to your Convex deployment
          const convex = new ConvexClient("https://helpful-marlin-890.convex.cloud");

          async function showSportsData() {
            try {
              const data = await convex.query(api.sportsAnalytics.getAllData); // Adjusted to your table & query name
              const container = document.getElementById("user-table");

              if (!data || data.length === 0) {
                container.innerHTML = "No data found.";
                return;
              }

              let html = "<table border='1' cellpadding='6'><tr><th>Game ID</th><th>Team</th><th>Score</th></tr>";
              for (const row of data) {
                html += `<tr><td>${row.game_id}</td></tr>`;
              }
              html += "</table>";

              container.innerHTML = html;
            } catch (err) {
              console.error("Error fetching sportsAnalytics data:", err);
              document.getElementById("user-table").innerText = "Error loading data.";
            }
          }

          showSportsData();
    </script>

    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const uploaderSection = document.getElementById('uploaderSection');
            const dashboardSection = document.getElementById('dashboardSection');
            const howItWorksSection = document.getElementById('howItWorksSection');
            
            const videoUpload = document.getElementById('videoUpload');
            const fileInfo = document.getElementById('fileInfo');
            const videoPlayer = document.getElementById('videoPlayer');
            
            const statState = document.getElementById('statState');
            const statPlayCount = document.getElementById('statPlayCount');
            const statPauseCount = document.getElementById('statPauseCount');
            const statSeekCount = document.getElementById('statSeekCount');
            const statCompleted = document.getElementById('statCompleted');

            const eventLog = document.getElementById('eventLog');
            const progressChartCanvas = document.getElementById('progressChart').getContext('2d');

            let videoSrcUrl = null;
            let analyticsCleanup = null;
            let progressChart = null;
            
            // Accordion Logic
            document.querySelectorAll('.accordion-button').forEach(button => {
                button.addEventListener('click', () => {
                    const content = button.nextElementSibling;
                    button.classList.toggle('open');
                    content.classList.toggle('hidden');
                });
            });

            // File selection logic
            videoUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;

                // Cleanup previous video and analytics
                if (videoSrcUrl) {
                    URL.revokeObjectURL(videoSrcUrl);
                }
                if (analyticsCleanup) {
                    analyticsCleanup();
                }

                fileInfo.textContent = `Selected: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                videoSrcUrl = URL.createObjectURL(file);
                videoPlayer.src = videoSrcUrl;
                
                uploaderSection.classList.add('hidden');
                dashboardSection.classList.remove('hidden');
                howItWorksSection.classList.remove('hidden');

                // Initialize analytics for the new video
                analyticsCleanup = createVideoAnalytics(videoPlayer, updateUI);
            });

            function initializeChart() {
                if (progressChart) {
                    progressChart.destroy();
                }
                progressChart = new Chart(progressChartCanvas, {
                    type: 'doughnut',
                    data: {
                        labels: ['Watched', 'Remaining'],
                        datasets: [{
                            data: [0, 100],
                            backgroundColor: ['#f59e0b', '#e2e8f0'],
                            borderColor: ['#ffffff', '#ffffff'],
                            borderWidth: 4,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: false
                            }
                        }
                    }
                });
            }

            function updateUI(analytics) {
                statState.textContent = analytics.playbackState.charAt(0).toUpperCase() + analytics.playbackState.slice(1);
                statPlayCount.textContent = analytics.playCount;
                statPauseCount.textContent = analytics.pauseCount;
                statSeekCount.textContent = analytics.seekCount;
                statCompleted.textContent = analytics.isCompleted ? 'Yes' : 'No';

                if(progressChart) {
                    progressChart.data.datasets[0].data[0] = analytics.totalWatchTime;
                    const remainingTime = Math.max(0, analytics.duration - analytics.totalWatchTime);
                    progressChart.data.datasets[0].data[1] = remainingTime > 0.1 ? remainingTime : 0;
                    progressChart.update();
                }
            }
            
            function logEvent(name, data) {
                if (eventLog.children.length > 50) {
                     eventLog.removeChild(eventLog.lastChild);
                }
                const p = document.createElement('p');
                p.className = 'event-log-entry text-sm text-slate-700 bg-slate-100 p-2 rounded';
                p.innerHTML = `<span class="font-semibold text-amber-700">${name}</span> at ${data.currentTime.toFixed(2)}s`;
                
                if (eventLog.firstChild && eventLog.firstChild.textContent.includes('Interact with the video')) {
                    eventLog.innerHTML = '';
                }
                
                eventLog.prepend(p);
            }
            
            function createVideoAnalytics(videoElement, onUpdateCallback) {
                const initialState = {
                    playbackState: 'idle',
                    playCount: 0,
                    pauseCount: 0,
                    seekCount: 0,
                    currentTime: 0,
                    duration: 0,
                    progressPercentage: 0,
                    totalWatchTime: 0,
                    isCompleted: false,
                };
                
                let analyticsState = { ...initialState };
                let lastPlayTimestamp = null;
                let lastProgressInt = -1;

                function update(newState) {
                    analyticsState = { ...analyticsState, ...newState };
                    onUpdateCallback(analyticsState);
                }

                const handlePlay = (e) => {
                    if (analyticsState.playbackState === 'idle' || analyticsState.playbackState === 'finished') {
                        update({ playCount: analyticsState.playCount + 1, isCompleted: false });
                    }
                    update({ playbackState: 'playing' });
                    lastPlayTimestamp = Date.now();
                    logEvent('play', e.target);
                };

                const handlePause = (e) => {
                    update({ playbackState: 'paused', pauseCount: analyticsState.pauseCount + 1 });
                    if (lastPlayTimestamp) {
                        const elapsed = (Date.now() - lastPlayTimestamp) / 1000;
                        update({ totalWatchTime: analyticsState.totalWatchTime + elapsed });
                        lastPlayTimestamp = null;
                    }
                    logEvent('pause', e.target);
                };
                
                const handleEnded = (e) => {
                    update({ playbackState: 'finished', isCompleted: true, progressPercentage: 100 });
                     if (lastPlayTimestamp) {
                        const elapsed = (Date.now() - lastPlayTimestamp) / 1000;
                        update({ totalWatchTime: analyticsState.totalWatchTime + elapsed });
                        lastPlayTimestamp = null;
                    }
                    logEvent('ended', e.target);
                };
                
                const handleSeeking = (e) => {
                    update({ playbackState: 'seeking', seekCount: analyticsState.seekCount + 1 });
                    if (lastPlayTimestamp) {
                        const elapsed = (Date.now() - lastPlayTimestamp) / 1000;
                        update({ totalWatchTime: analyticsState.totalWatchTime + elapsed });
                        lastPlayTimestamp = null;
                    }
                    logEvent('seeking', e.target);
                };
                
                const handleSeeked = (e) => {
                    update({ playbackState: videoElement.paused ? 'paused' : 'playing' });
                    if(!videoElement.paused) {
                        lastPlayTimestamp = Date.now();
                    }
                    logEvent('seeked', e.target);
                };

                const handleTimeUpdate = (e) => {
                    const duration = e.target.duration;
                    if (duration > 0) {
                        const progress = (e.target.currentTime / duration) * 100;
                        const progressInt = Math.floor(progress);
                        if (progressInt !== lastProgressInt) {
                            update({
                                currentTime: e.target.currentTime,
                                duration: duration,
                                progressPercentage: progress
                            });
                            lastProgressInt = progressInt;
                        }
                    }
                };
                
                const handleLoadedMetadata = (e) => {
                    update({ ...initialState, duration: e.target.duration });
                    initializeChart();
                    onUpdateCallback({ ...initialState, duration: e.target.duration });
                    logEvent('loadedmetadata', e.target);
                };

                videoElement.addEventListener('play', handlePlay);
                videoElement.addEventListener('pause', handlePause);
                videoElement.addEventListener('ended', handleEnded);
                videoElement.addEventListener('seeking', handleSeeking);
                videoElement.addEventListener('seeked', handleSeeked);
                videoElement.addEventListener('timeupdate', handleTimeUpdate);
                videoElement.addEventListener('loadedmetadata', handleLoadedMetadata);

                return () => {
                    videoElement.removeEventListener('play', handlePlay);
                    videoElement.removeEventListener('pause', handlePause);
                    videoElement.removeEventListener('ended', handleEnded);
                    videoElement.removeEventListener('seeking', handleSeeking);
                    videoElement.removeEventListener('seeked', handleSeeked);
                    videoElement.removeEventListener('timeupdate', handleTimeUpdate);
                    videoElement.removeEventListener('loadedmetadata', handleLoadedMetadata);
                };
            }
        });
    </script>
</body>
</html>
